# Building the image using my Oracle JDK 7
FROM oraclejdk_7

# Naming me as the maintainer
MAINTAINER Sebastien Bonami

# Installing OpenSSH
RUN sudo apt-get install -y openssh-server
RUN ssh-keygen -t rsa -f /root/.ssh/id_rsa -N ''
RUN cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
#RUN sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Installing HADOOP 2.3.0
ADD http://archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0.tar.gz /
RUN sudo tar -zxf /hadoop-2.3.0.tar.gz
RUN sudo rm /hadoop-2.3.0.tar.gz
RUN sudo mv /hadoop-2.3.0 /usr/local
RUN sudo ln -s /usr/local/hadoop-2.3.0 /usr/local/hadoop

# Setting HADOOP environment variables
ENV HADOOP_INSTALL /usr/local/hadoop
ENV PATH $PATH:$HADOOP_INSTALL/bin
ENV PATH $PATH:$HADOOP_INSTALL/sbin
ENV HADOOP_MAPRED_HOME $HADOOP_INSTALL
ENV HADOOP_COMMON_HOME $HADOOP_INSTALL
ENV HADOOP_HDFS_HOME $HADOOP_INSTALL
ENV HADOOP_COMMON_LIB_NATIVE_DIR $HADOOP_INSTALL/lib/native
ENV YARN_HOME $HADOOP_INSTALL

# Setting JAVA_HOME environment variable for HADOOP
RUN sed -i 's/JAVA_HOME=${JAVA_HOME}/JAVA_HOME=\/usr\/lib\/jvm\/jdk/g' /usr/local/hadoop/etc/hadoop/hadoop-env.sh

# Creating HDFS directories
RUN mkdir -p /hdfs-volume/namenode
RUN mkdir -p /hdfs-volume/datanode

# Copying HADOOP configuration files
ADD core-site.xml $HADOOP_INSTALL/etc/hadoop/core-site.xml
ADD yarn-site.xml $HADOOP_INSTALL/etc/hadoop/yarn-site.xml
ADD mapred-site.xml $HADOOP_INSTALL/etc/hadoop/mapred-site.xml
ADD hdfs-site.xml $HADOOP_INSTALL/etc/hadoop/hdfs-site.xml

# Formatting HDFS NameNode
RUN hdfs namenode -format